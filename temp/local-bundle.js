angular.module("PlattarEmbed",[]).constant("config",{apiUrl:"https://10.2.47.120",sceneId:"263577a8-fd44-4d8b-a0c6-e5d75ebc5272"}).config(["$sceDelegateProvider",function(t){t.resourceUrlWhitelist(["self","https://dbtuhhzmxl35f.cloudfront.net/**","https://**.cloudfront.net/**"])}]).run(["config",function(t){}]).controller("mainController",["$scope","$element","$interval","config",function(e,t,n,l){e.loaded=!1,e.requestFullscreen=function(){e.plattar.toggleFullscreen(t[0])},angular.element(function(){e.plattar=new PlattarIntegration(l);var t=n(function(){e.plattar.init(function(){n.cancel(t),e.plattar.openScene(l.sceneId),e.loaded=!0,e.$apply()})},250)})}]);
angular.module("PlattarEmbed").controller("configurator",["$scope","config",function(i,t){i.scene,i.products,i.plattar.api.getScene(t.sceneId,function(t){i.scene=t,i.$apply()}),i.plattar.api.listProducts(t.sceneId,function(t){i.products=t,i.$apply()}),i.selectVariation=function(t,n){t.selectedVariation=n,i.plattar.loadVariation(t.instanceid,n.id)},i.toggleVisibility=function(){$(".configurator-container").toggleClass("configurator-container-visible")}}]);
"use strict";angular.module("PlattarEmbed").directive("icon",function(){return{templateUrl:function(r,t){return t.src?t.src:(r.attr("src",t["ng-src"]),"icons/icon-blank.svg")}}});
angular.module("PlattarEmbed").directive("img",function(){return{restrict:"E",scope:!0,controller:["$scope","$element",function(o,t){t.addClass("smoothload"),t.addClass("smoothload-out"),t.on("load",function(){t.removeClass("smoothload-out")})}]}});
function PlattarIntegration(o){void 0===(o=o||{}).apiUrl&&(o.apiUrl="https://app.plattar.com");var n=document.querySelector("#plattar-frame"),i=this;function c(t,e){n?(t=t.toLowerCase(),n!==window&&(console.log("%c"+t,"background: #61ff61; color: #000; padding:4px 8px;",e),targetOrigin=o.apiUrl,n.contentWindow.postMessage({eventName:t,data:e||{}},o.apiUrl))):setTimeout(function(){c(t,e)},500)}this.readyFunc=function(){console.log("not ready")},this.init=function(t){this.readyFunc=t,c("initpreview",{origin:origin,options:{helpslides:!1}})},window.addEventListener("message",function(t){console.log("%c"+t.data.eventName,"background: #6170ff; color: #000; padding:4px 8px;",t.data.data);var e=t.data.data;switch(t.data.eventName){case"previewready":i.readyFunc();break;case"openurl":t.data.data.url&&window.open(e.url,"_blank");break;case"selectannotation":e.title||(e.url?window.open(e.url,"_blank"):e.scene_id&&(config.sceneId=e.scene_id,i.openScene(e.scceneId)))}}),this.openScene=function(t){c("loadscene",{sceneId:t})},this.loadVariation=function(t,e){c("loadproduct",{productId:t,variationId:e})},this.toggleCamera=function(t){c("toggleCamera",{active:t})},this.activateHelp=function(){c("activateHelp",{})};var r=!(this.resetTransforms=function(){c("resetTransform",{})}),a={};this.toggleFullscreen=function(t){var e,n=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;r||n?((e=t)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():$(e).css(a)),r=!1):function(t){if(t){var e=window.document.documentElement,n=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen;n?n.call(t):(a.position=$(t).css("position"),a.top=$(t).css("top"),a.left=$(t).css("left"),a.bottom=$(t).css("bottom"),a.right=$(t).css("right"),a.height=$(t).css("height"),$(t).css({position:"fixed",top:0,left:0,bottom:0,right:0,height:"100%"}))}else c("goFullscreen",{});r=!0}(t)},this.api={getScene:function(t,e,n){$.get(o.apiUrl+"/api/v2/scene/"+t,function(t){e(t.data)}).fail(function(t){n&&n(t)})},listProducts:function(i,c,e){$.get(o.apiUrl+"/api/v2/scene/"+i+"?include=product,product.productvariation,product.productvariation.file,sceneproduct,sceneproduct.product,sceneproduct.product.productvariation,sceneproduct.product.productvariation.file",function(n){if(n.included&&n.included.length){var t=n.included.filter(function(t){return"product"==t.type&&t.attributes.scene_id==i}).map(function(t){return t.instanceid=t.id,t}),e=n.included.filter(function(t){return"sceneproduct"==t.type}).map(function(e){var t=n.included.find(function(t){return e.attributes.product_id==t.id});return(t=JSON.parse(JSON.stringify(t))).instanceid=e.id,t.attributes.title=e.attributes.title,t.attributes.scene_id=e.attributes.scene_id,t});e.length&&(t=t.concat(e)),t.forEach(function(e){e.variations=n.included.filter(function(t){return"productvariation"==t.type&&t.attributes.product_id==e.id}),e.variations.forEach(function(e){var t;(t=e.attributes.swatch_id?n.included.find(function(t){return t.id==e.attributes.swatch_id}):n.included.find(function(t){return t.id==e.attributes.file_id}))&&(e.thumbnail=encodeURI("https://cdn-dev.plattar.space/"+t.attributes.path+t.attributes.thumbnail))}),e.selectedVariation=e.variations.find(function(t){return t.id==e.attributes.product_variation_id})}),c(t)}}).fail(function(t){e&&e(t)})}}}
angular.module("PlattarEmbed").controller("viewer",["$scope","config","$sce",function(n,e,l){n.embedUrl=l.trustAsResourceUrl(e.apiUrl+"/webgleditor/preview/index.html");var t=n.isFullscreen=!1;n.toggleCamera=function(){t=!t,n.plattar.toggleCamera(t)},n.goFullscreen=function(){n.requestFullscreen(),n.isFullscreen=!n.isFullscreen},n.activateHelp=function(e){n.plattar.activateHelp()},n.resetTransforms=function(){n.plattar.resetTransforms()},document.onfullscreenchange=document.onwebkitfullscreenchange=document.onmozfullscreenchange=document.MSFullscreenChange=function(e){n.isFullscreen=Document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,n.$apply()}}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbmZpZ3VyYXRvci9jb25maWd1cmF0b3IuanMiLCJkaXJlY3RpdmVzL2ljb24uanMiLCJkaXJlY3RpdmVzL3Ntb290aGxvYWQuanMiLCJwbGF0dGFyQVBJL3BsYXR0YXJBUEkuanMiLCJ2aWV3ZXIvdmlld2VyLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25zdGFudCIsImFwaVVybCIsInNjZW5lSWQiLCJjb25maWciLCIkc2NlRGVsZWdhdGVQcm92aWRlciIsInJlc291cmNlVXJsV2hpdGVsaXN0IiwicnVuIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRlbGVtZW50IiwiJGludGVydmFsIiwibG9hZGVkIiwicmVxdWVzdEZ1bGxzY3JlZW4iLCJwbGF0dGFyIiwidG9nZ2xlRnVsbHNjcmVlbiIsImVsZW1lbnQiLCJQbGF0dGFySW50ZWdyYXRpb24iLCJpbnR2IiwiaW5pdCIsImNhbmNlbCIsIm9wZW5TY2VuZSIsIiRhcHBseSIsInNjZW5lIiwicHJvZHVjdHMiLCJhcGkiLCJnZXRTY2VuZSIsInJlc3VsdCIsImxpc3RQcm9kdWN0cyIsInNlbGVjdFZhcmlhdGlvbiIsInByb2R1Y3QiLCJ2YXJpYXRpb24iLCJzZWxlY3RlZFZhcmlhdGlvbiIsImxvYWRWYXJpYXRpb24iLCJpbnN0YW5jZWlkIiwiaWQiLCJ0b2dnbGVWaXNpYmlsaXR5IiwiJCIsInRvZ2dsZUNsYXNzIiwiZGlyZWN0aXZlIiwidGVtcGxhdGVVcmwiLCJlbGVtIiwiYXR0ciIsInNyYyIsInJlc3RyaWN0Iiwic2NvcGUiLCJhZGRDbGFzcyIsIm9uIiwicmVtb3ZlQ2xhc3MiLCJwYXJhbXMiLCJ1bmRlZmluZWQiLCJpZnJhbWUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZWxmIiwidGhpcyIsInNlbmRNZXNzYWdlIiwiYWN0aW9uIiwiZGF0YSIsInRvTG93ZXJDYXNlIiwid2luZG93IiwiY29uc29sZSIsImxvZyIsInRhcmdldE9yaWdpbiIsImNvbnRlbnRXaW5kb3ciLCJwb3N0TWVzc2FnZSIsImV2ZW50TmFtZSIsInNldFRpbWVvdXQiLCJyZWFkeUZ1bmMiLCJjYiIsIm9yaWdpbiIsIm9wdGlvbnMiLCJoZWxwc2xpZGVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ1cmwiLCJvcGVuIiwidGl0bGUiLCJzY2VuZV9pZCIsInNjY2VuZUlkIiwicHJvZHVjdElkIiwidmFyaWF0aW9uSWQiLCJ0b2dnbGVDYW1lcmEiLCJhY3RpdmUiLCJhY3RpdmF0ZUhlbHAiLCJpc0Z1bGxzY3JlZW4iLCJyZXNldFRyYW5zZm9ybXMiLCJzdG9yZWRDc3MiLCJmdWxsc2NyZWVuRWxlbWVudCIsIndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50IiwibW96RnVsbFNjcmVlbkVsZW1lbnQiLCJtc0Z1bGxzY3JlZW5FbGVtZW50IiwiZXhpdEZ1bGxzY3JlZW4iLCJ3ZWJraXRFeGl0RnVsbHNjcmVlbiIsIm1vekNhbmNlbEZ1bGxTY3JlZW4iLCJtc0V4aXRGdWxsc2NyZWVuIiwiY3NzIiwiZG9jRWwiLCJkb2N1bWVudEVsZW1lbnQiLCJyZXF1ZXN0RnVsbFNjcmVlbiIsIm1velJlcXVlc3RGdWxsU2NyZWVuIiwid2Via2l0UmVxdWVzdEZ1bGxTY3JlZW4iLCJtc1JlcXVlc3RGdWxsc2NyZWVuIiwiY2FsbCIsInBvc2l0aW9uIiwidG9wIiwibGVmdCIsImJvdHRvbSIsInJpZ2h0IiwiaGVpZ2h0IiwiZ29GdWxsc2NyZWVuIiwic3VjY2Vzc0Z1bmMiLCJlcnJvckZ1bmMiLCJnZXQiLCJmYWlsIiwiZXJyb3IiLCJpbmNsdWRlZCIsImxlbmd0aCIsImZpbHRlciIsImluY2x1ZGUiLCJ0eXBlIiwiYXR0cmlidXRlcyIsIm1hcCIsInNjZW5lcHJvZHVjdHMiLCJzY2VuZXByb2R1Y3QiLCJmaW5kIiwicHJvZHVjdF9pZCIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsImNvbmNhdCIsImZvckVhY2giLCJ2YXJpYXRpb25zIiwidGh1bWIiLCJzd2F0Y2hfaWQiLCJmaWxlX2lkIiwidGh1bWJuYWlsIiwiZW5jb2RlVVJJIiwicGF0aCIsInByb2R1Y3RfdmFyaWF0aW9uX2lkIiwiJHNjZSIsImVtYmVkVXJsIiwidHJ1c3RBc1Jlc291cmNlVXJsIiwiY2FtZXJhRW5hYmxlZCIsImV2ZW50Iiwib25mdWxsc2NyZWVuY2hhbmdlIiwib253ZWJraXRmdWxsc2NyZWVuY2hhbmdlIiwib25tb3pmdWxsc2NyZWVuY2hhbmdlIiwiTVNGdWxsc2NyZWVuQ2hhbmdlIiwiRG9jdW1lbnQiXSwibWFwcGluZ3MiOiJBQUVBQSxRQUFRQyxPQUFPLGVBQWdCLElBQzlCQyxTQUFTLFNBQVUsQ0FDbkJDLE9BQVEsc0JBQ1JDLFFBQVMseUNBRVRDLE9BQU8sQ0FBQyx1QkFBd0IsU0FBVUMsR0FFMUNBLEVBQXFCQyxxQkFBcUIsQ0FDekMsT0FDQSwwQ0FDQSxvQ0FrQ0RDLElBQUksQ0FBQyxTQUNMLFNBQVVILE9BSVZJLFdBQVcsaUJBQWtCLENBQUMsU0FBVSxXQUFZLFlBQWEsU0FDakUsU0FBU0MsRUFBUUMsRUFBVUMsRUFBV1AsR0FFckNLLEVBQU9HLFFBQVMsRUFFaEJILEVBQU9JLGtCQUFvQixXQUMxQkosRUFBT0ssUUFBUUMsaUJBQWlCTCxFQUFTLEtBSTFDWCxRQUFRaUIsUUFBUSxXQUNmUCxFQUFPSyxRQUFVLElBQUlHLG1CQUFtQmIsR0FFeEMsSUFBSWMsRUFBT1AsRUFBVSxXQUNwQkYsRUFBT0ssUUFBUUssS0FBSyxXQUNuQlIsRUFBVVMsT0FBT0YsR0FDakJULEVBQU9LLFFBQVFPLFVBQVVqQixFQUFPRCxTQUNoQ00sRUFBT0csUUFBUyxFQUNoQkgsRUFBT2EsWUFFTjtBQ3RFTnZCLFFBQVFDLE9BQU8sZ0JBQ2RRLFdBQVcsZUFBZ0IsQ0FBQyxTQUFVLFNBQ3RDLFNBQVNDLEVBQVFMLEdBQ2hCSyxFQUFPYyxNQUNQZCxFQUFPZSxTQUVQZixFQUFPSyxRQUFRVyxJQUFJQyxTQUFTdEIsRUFBT0QsUUFBUyxTQUFTd0IsR0FDcERsQixFQUFPYyxNQUFRSSxFQUNmbEIsRUFBT2EsV0FHUmIsRUFBT0ssUUFBUVcsSUFBSUcsYUFBYXhCLEVBQU9ELFFBQVMsU0FBU3dCLEdBQ3hEbEIsRUFBT2UsU0FBV0csRUFDbEJsQixFQUFPYSxXQUdSYixFQUFPb0IsZ0JBQWtCLFNBQVNDLEVBQVNDLEdBQzFDRCxFQUFRRSxrQkFBb0JELEVBQzVCdEIsRUFBT0ssUUFBUW1CLGNBQWNILEVBQVFJLFdBQVlILEVBQVVJLEtBRzVEMUIsRUFBTzJCLGlCQUFtQixXQUN6QkMsRUFBRSwyQkFBMkJDLFlBQVk7QUN2QjVDLGFBRUF2QyxRQUFRQyxPQUFPLGdCQUNkdUMsVUFBVSxPQUFRLFdBQ2xCLE1BQU8sQ0FDTkMsWUFBYSxTQUFTQyxFQUFNQyxHQUMzQixPQUFJQSxFQUFLQyxJQUlGRCxFQUFLQyxLQUhYRixFQUFLQyxLQUFLLE1BQU9BLEVBQUssV0FDZjtBQ1BYM0MsUUFBUUMsT0FBTyxnQkFDZHVDLFVBQVUsTUFBTyxXQUNqQixNQUFPLENBQ05LLFNBQVUsSUFDVkMsT0FBTyxFQUNQckMsV0FBWSxDQUFDLFNBQVUsV0FDdEIsU0FBU0MsRUFBUUMsR0FDaEJBLEVBQVNvQyxTQUFTLGNBQ2xCcEMsRUFBU29DLFNBQVMsa0JBQ2xCcEMsRUFBU3FDLEdBQUcsT0FBUSxXQUNuQnJDLEVBQVNzQyxZQUFZO0FDVjFCLFNBQVMvQixtQkFBbUJnQyxRQUVOQyxLQURqQkQsRUFBU0EsR0FBVSxJQUNiL0MsU0FDVCtDLEVBQU8vQyxPQUFTLDJCQUdoQixJQUFJaUQsRUFBU0MsU0FBU0MsY0FBYyxrQkFDaENDLEVBQU9DLEtBYVosU0FBU0MsRUFBWUMsRUFBUUMsR0FFeEJQLEdBT0pNLEVBQVNBLEVBQU9FLGNBQ2JSLElBQVdTLFNBQ1hDLFFBQVFDLElBQUksS0FBT0wsRUFBUSxxREFBc0RDLEdBQ2pGSyxhQUFlZCxFQUFPL0MsT0FDckJpRCxFQUFPYSxjQUFjQyxZQUFZLENBQUNDLFVBQVdULEVBQVFDLEtBQU1BLEdBQVEsSUFBS1QsRUFBTy9DLFVBVmxGaUUsV0FBVyxXQUNWWCxFQUFZQyxFQUFRQyxJQUNsQixLQWpCSkgsS0FBS2EsVUFBWSxXQUFXUCxRQUFRQyxJQUFJLGNBRXhDUCxLQUFLcEMsS0FBTyxTQUFTa0QsR0FDcEJkLEtBQUthLFVBQVlDLEVBQ2pCYixFQUFZLGNBQWUsQ0FDekJjLE9BQVFBLE9BQ1JDLFFBQVMsQ0FDUkMsWUFBWSxNQXNCakJaLE9BQU9hLGlCQUFpQixVQUFXLFNBQVNDLEdBQ3pDYixRQUFRQyxJQUFJLEtBQU9ZLEVBQUVoQixLQUFLUSxVQUFXLHFEQUFzRFEsRUFBRWhCLEtBQUtBLE1BQ2xHLElBQUlBLEVBQU9nQixFQUFFaEIsS0FBS0EsS0FFbEIsT0FBT2dCLEVBQUVoQixLQUFLUSxXQUNaLElBQUssZUFDSlosRUFBS2MsWUFDSixNQUVGLElBQUssVUFDQU0sRUFBRWhCLEtBQUtBLEtBQUtpQixLQUNiZixPQUFPZ0IsS0FBS2xCLEVBQUtpQixJQUFLLFVBRXhCLE1BRUYsSUFBSyxtQkFFQWpCLEVBQUttQixRQUlBbkIsRUFBS2lCLElBRVhmLE9BQU9nQixLQUFLbEIsRUFBS2lCLElBQUssVUFHaEJqQixFQUFLb0IsV0FFWjFFLE9BQU9ELFFBQVV1RCxFQUFLb0IsU0FFckJ4QixFQUFLakMsVUFBVXFDLEVBQUtxQixlQU03QnhCLEtBQUtsQyxVQUFZLFNBQVNsQixHQUN6QnFELEVBQVksWUFBYSxDQUN4QnJELFFBQVNBLEtBSVhvRCxLQUFLdEIsY0FBZ0IsU0FBUytDLEVBQVdDLEdBQ3hDekIsRUFBWSxjQUFlLENBQzFCd0IsVUFBV0EsRUFDWEMsWUFBYUEsS0FJZjFCLEtBQUsyQixhQUFlLFNBQVNDLEdBQzVCM0IsRUFBWSxlQUFnQixDQUFDMkIsT0FBUUEsS0FHdEM1QixLQUFLNkIsYUFBZSxXQUNuQjVCLEVBQVksZUFBZ0IsS0FPN0IsSUFBSTZCLElBSko5QixLQUFLK0IsZ0JBQWtCLFdBQ3RCOUIsRUFBWSxpQkFBa0IsTUFJM0IrQixFQUFZLEdBc0RoQmhDLEtBQUt4QyxpQkFBbUIsU0FBUzBCLEdBQ2hDLElBckJ1QkEsRUFxQm5CK0MsRUFBb0JwQyxTQUFTb0MsbUJBQXFCcEMsU0FBU3FDLHlCQUEyQnJDLFNBQVNzQyxzQkFBd0J0QyxTQUFTdUMsb0JBQ2pJTixHQUFnQkcsSUF0QkkvQyxFQXVCUEEsS0FwQlhXLFNBQVN3QyxlQUNaeEMsU0FBU3dDLGlCQUNDeEMsU0FBU3lDLHFCQUNuQnpDLFNBQVN5Qyx1QkFDQ3pDLFNBQVMwQyxvQkFDbkIxQyxTQUFTMEMsc0JBQ0MxQyxTQUFTMkMsaUJBQ25CM0MsU0FBUzJDLG1CQUlUMUQsRUFBRUksR0FBTXVELElBQUlULElBR2RGLEdBQWUsR0FsRGhCLFNBQXNCNUMsR0FDckIsR0FBR0EsRUFBSyxDQUNQLElBQUl3RCxFQUFRckMsT0FBT1IsU0FBUzhDLGdCQUN4QkMsRUFBb0JGLEVBQU1wRixtQkFBcUJvRixFQUFNRyxzQkFBd0JILEVBQU1JLHlCQUEyQkosRUFBTUssb0JBRXJISCxFQUNGQSxFQUFrQkksS0FBSzlELElBSXZCOEMsRUFBVWlCLFNBQVduRSxFQUFFSSxHQUFNdUQsSUFBSSxZQUNqQ1QsRUFBVWtCLElBQU1wRSxFQUFFSSxHQUFNdUQsSUFBSSxPQUM1QlQsRUFBVW1CLEtBQU9yRSxFQUFFSSxHQUFNdUQsSUFBSSxRQUM3QlQsRUFBVW9CLE9BQVN0RSxFQUFFSSxHQUFNdUQsSUFBSSxVQUMvQlQsRUFBVXFCLE1BQVF2RSxFQUFFSSxHQUFNdUQsSUFBSSxTQUM5QlQsRUFBVXNCLE9BQVN4RSxFQUFFSSxHQUFNdUQsSUFBSSxVQUUvQjNELEVBQUVJLEdBQU11RCxJQUFJLENBQ1hRLFNBQVUsUUFDVkMsSUFBSyxFQUNMQyxLQUFNLEVBQ05DLE9BQVEsRUFDUkMsTUFBTyxFQUNQQyxPQUFRLGVBS1ZyRCxFQUFZLGVBQWdCLElBRTdCNkIsR0FBZSxFQTZCZHlCLENBQWFyRSxJQUlmYyxLQUFLOUIsSUFBTSxDQUNWQyxTQUFVLFNBQVN2QixFQUFTNEcsRUFBYUMsR0FDeEMzRSxFQUFFNEUsSUFBSWhFLEVBQU8vQyxPQUFTLGlCQUFpQkMsRUFBUyxTQUFTd0IsR0FDeERvRixFQUFZcEYsRUFBTytCLFFBRW5Cd0QsS0FBSyxTQUFTQyxHQUNYSCxHQUNGQSxFQUFVRyxNQUtidkYsYUFBYyxTQUFTekIsRUFBUzRHLEVBQWFDLEdBQzVDM0UsRUFBRTRFLElBQUloRSxFQUFPL0MsT0FBUyxpQkFBaUJDLEVBQVEsNkxBQThMLFNBQVN3QixHQUNyUCxHQUFHQSxFQUFPeUYsVUFBWXpGLEVBQU95RixTQUFTQyxPQUFPLENBQzVDLElBQUk3RixFQUFXRyxFQUFPeUYsU0FBU0UsT0FBTyxTQUFTQyxHQUM5QyxNQUF3QixXQUFoQkEsRUFBUUMsTUFBcUJELEVBQVFFLFdBQVczQyxVQUFZM0UsSUFFcEV1SCxJQUFJLFNBQVM1RixHQUViLE9BREFBLEVBQVFJLFdBQWFKLEVBQVFLLEdBQ3RCTCxJQUlKNkYsRUFBZ0JoRyxFQUFPeUYsU0FBU0UsT0FBTyxTQUFTQyxHQUNuRCxNQUF1QixnQkFBaEJBLEVBQVFDLE9BRWZFLElBQUksU0FBU0UsR0FDYixJQUFJOUYsRUFBVUgsRUFBT3lGLFNBQVNTLEtBQUssU0FBU04sR0FDM0MsT0FBT0ssRUFBYUgsV0FBV0ssWUFBY1AsRUFBUXBGLEtBUXRELE9BTEFMLEVBQVVpRyxLQUFLQyxNQUFNRCxLQUFLRSxVQUFVbkcsS0FFNUJJLFdBQWEwRixFQUFhekYsR0FDbENMLEVBQVEyRixXQUFXNUMsTUFBUStDLEVBQWFILFdBQVc1QyxNQUNuRC9DLEVBQVEyRixXQUFXM0MsU0FBVzhDLEVBQWFILFdBQVczQyxTQUMvQ2hELElBSUw2RixFQUFjTixTQUNoQjdGLEVBQVdBLEVBQVMwRyxPQUFPUCxJQUc1Qm5HLEVBQVMyRyxRQUFRLFNBQVNyRyxHQUN6QkEsRUFBUXNHLFdBQWF6RyxFQUFPeUYsU0FBU0UsT0FBTyxTQUFTQyxHQUNwRCxNQUF1QixvQkFBaEJBLEVBQVFDLE1BQStCRCxFQUFRRSxXQUFXSyxZQUFjaEcsRUFBUUssS0FHeEZMLEVBQVFzRyxXQUFXRCxRQUFRLFNBQVNwRyxHQUNuQyxJQUFJc0csR0FFSEEsRUFERXRHLEVBQVUwRixXQUFXYSxVQUNmM0csRUFBT3lGLFNBQVNTLEtBQUssU0FBU04sR0FDckMsT0FBT0EsRUFBUXBGLElBQU1KLEVBQVUwRixXQUFXYSxZQUluQzNHLEVBQU95RixTQUFTUyxLQUFLLFNBQVNOLEdBQ3JDLE9BQU9BLEVBQVFwRixJQUFNSixFQUFVMEYsV0FBV2MsYUFJM0N4RyxFQUFVeUcsVUFBWUMsVUFBVSxpQ0FBbUNKLEVBQU1aLFdBQVdpQixLQUFPTCxFQUFNWixXQUFXZSxjQUk5RzFHLEVBQVFFLGtCQUFvQkYsRUFBUXNHLFdBQVdQLEtBQUssU0FBUzlGLEdBQzVELE9BQU9BLEVBQVVJLElBQU1MLEVBQVEyRixXQUFXa0IseUJBSTVDNUIsRUFBWXZGLE1BR2IwRixLQUFLLFNBQVNDLEdBQ1hILEdBQ0ZBLEVBQVVHO0FDaFBmcEgsUUFBUUMsT0FBTyxnQkFDZFEsV0FBVyxTQUFVLENBQUMsU0FBVSxTQUFVLE9BQzFDLFNBQVNDLEVBQVFMLEVBQVF3SSxHQUN4Qm5JLEVBQU9vSSxTQUFXRCxFQUFLRSxtQkFBbUIxSSxFQUFPRixPQUFTLG1DQUcxRCxJQUFJNkksRUFGSnRJLEVBQU80RSxjQUFlLEVBR3RCNUUsRUFBT3lFLGFBQWUsV0FDckI2RCxHQUFpQkEsRUFDakJ0SSxFQUFPSyxRQUFRb0UsYUFBYTZELElBRzdCdEksRUFBT3FHLGFBQWUsV0FFckJyRyxFQUFPSSxvQkFDUEosRUFBTzRFLGNBQWdCNUUsRUFBTzRFLGNBRy9CNUUsRUFBTzJFLGFBQWUsU0FBUzRELEdBQzlCdkksRUFBT0ssUUFBUXNFLGdCQUdoQjNFLEVBQU82RSxnQkFBa0IsV0FDeEI3RSxFQUFPSyxRQUFRd0UsbUJBTWhCbEMsU0FBUzZGLG1CQUFxQjdGLFNBQVM4Rix5QkFBMkI5RixTQUFTK0Ysc0JBQXdCL0YsU0FBU2dHLG1CQUFxQixTQUFXSixHQUMzSXZJLEVBQU80RSxhQUhBZ0UsU0FBUzdELG1CQUFxQnBDLFNBQVNxQyx5QkFBMkJyQyxTQUFTc0Msc0JBQXdCdEMsU0FBU3VDLG9CQUluSGxGLEVBQU9hIiwiZmlsZSI6ImxvY2FsLWJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4vKiBBcHAgTW9kdWxlICovXHJcbmFuZ3VsYXIubW9kdWxlKCdQbGF0dGFyRW1iZWQnLCBbXSlcclxuLmNvbnN0YW50KCdjb25maWcnLCB7XHJcblx0YXBpVXJsOiAnaHR0cHM6Ly8xMC4yLjQ3LjEyMCcsXHJcblx0c2NlbmVJZDogJzI2MzU3N2E4LWZkNDQtNGQ4Yi1hMGM2LWU1ZDc1ZWJjNTI3MidcclxufSlcclxuLmNvbmZpZyhbJyRzY2VEZWxlZ2F0ZVByb3ZpZGVyJywgZnVuY3Rpb24gKCRzY2VEZWxlZ2F0ZVByb3ZpZGVyKSB7XHJcblx0Ly90aGlzIGFsbG93cyB1cyB0byBhdm9pZCBDT1JTIGVycm9zIGZyb20gdGhlc2Ugc2l0ZVxyXG5cdCRzY2VEZWxlZ2F0ZVByb3ZpZGVyLnJlc291cmNlVXJsV2hpdGVsaXN0KFtcclxuXHRcdCdzZWxmJyxcclxuXHRcdCdodHRwczovL2RidHVoaHpteGwzNWYuY2xvdWRmcm9udC5uZXQvKionLFxyXG5cdFx0J2h0dHBzOi8vKiouY2xvdWRmcm9udC5uZXQvKionLFxyXG5cdFx0XSk7XHJcbn1dKVxyXG4vKi5jb25maWcoW1xyXG5cdCckbG9jYXRpb25Qcm92aWRlcicsICckcm91dGVQcm92aWRlcicsXHJcblx0ZnVuY3Rpb24gKCRsb2NhdGlvblByb3ZpZGVyLCAkcm91dGVQcm92aWRlcikge1xyXG5cdCRyb3V0ZVByb3ZpZGVyXHJcblx0XHQud2hlbignL3ZlcmlmeS86dG9rZW4nLCB7XHJcblx0XHRcdHRlbXBsYXRlVXJsOiAndmVyaWZ5L3ZlcmlmeS5odG1sJyxcclxuXHRcdFx0Y29udHJvbGxlcjogJ3ZlcmlmeUNvbnRyb2xsZXInLFxyXG5cdFx0XHRyZWxvYWRPblNlYXJjaDogZmFsc2UsXHJcblx0XHRcdHRpdGxlOiAnVmVyaWZ5aW5nIFlvdXIgQWNjb3VudCdcclxuXHRcdH0pXHJcblx0XHQud2hlbignL2Rhc2hib2FyZCcsIHtcclxuXHRcdFx0dGVtcGxhdGVVcmw6ICdkYXNoYm9hcmQvZGFzaGJvYXJkLmh0bWwnLFxyXG5cdFx0XHRjb250cm9sbGVyOiAnZGFzaGJvYXJkQ29udHJvbGxlcicsXHJcblx0XHRcdHJlbG9hZE9uU2VhcmNoOiBmYWxzZSxcclxuXHRcdFx0dGFiTmFtZTogJ2Rhc2hib2FyZCcsXHJcblx0XHRcdHRpdGxlOiAnRGFzaGJvYXJkJ1xyXG5cdFx0fSlcclxuXHRcdC5vdGhlcndpc2Uoe1xyXG5cdFx0XHRyZWRpcmVjdFRvOiAnL2Rhc2hib2FyZCdcclxuXHRcdH0pO1xyXG5cclxuXHRcdCRsb2NhdGlvblByb3ZpZGVyLmhhc2hQcmVmaXgoJycpO1xyXG5cdH1cclxuXSkqL1xyXG4vKi5jb25maWcoWyckdWliVG9vbHRpcFByb3ZpZGVyJyxcclxuXHRmdW5jdGlvbiAoJHVpYlRvb2x0aXBQcm92aWRlcikge1xyXG5cdFx0JHVpYlRvb2x0aXBQcm92aWRlci5vcHRpb25zKHtcclxuXHRcdFx0Y29udGFpbmVyOiAnYm9keSdcclxuXHRcdH0pO1xyXG5cdH1dXHJcbikqL1xyXG4ucnVuKFsnY29uZmlnJyxcclxuXHRmdW5jdGlvbiAoY29uZmlnKSB7XHJcblx0XHQvLyBDaGVjayBmb3IgYSBzY2VuZUlkIGluIHRoZSB1cmwgaW5jbHVkZXMsIGFuZCBvdnZlcnJpZGUgY29uZmlnJ3Mgc2NlbmVJZCBpZiBzb1xyXG5cdH1cclxuXSlcclxuLmNvbnRyb2xsZXIoJ21haW5Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJGVsZW1lbnQnLCAnJGludGVydmFsJywgJ2NvbmZpZycsXHJcblx0ZnVuY3Rpb24oJHNjb3BlLCAkZWxlbWVudCwgJGludGVydmFsLCBjb25maWcpIHtcclxuXHJcblx0XHQkc2NvcGUubG9hZGVkID0gZmFsc2U7XHJcblxyXG5cdFx0JHNjb3BlLnJlcXVlc3RGdWxsc2NyZWVuID0gZnVuY3Rpb24oKXtcclxuXHRcdFx0JHNjb3BlLnBsYXR0YXIudG9nZ2xlRnVsbHNjcmVlbigkZWxlbWVudFswXSlcclxuXHRcdH07XHJcblxyXG5cdFx0Ly8gQ3JlYXRlcyB0aGUgY29ubmVjdGlvbiB0byB0aGUgaWZyYW1lIHJlbmRlcmVyXHJcblx0XHRhbmd1bGFyLmVsZW1lbnQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHQkc2NvcGUucGxhdHRhciA9IG5ldyBQbGF0dGFySW50ZWdyYXRpb24oY29uZmlnKTtcclxuXHJcblx0XHRcdHZhciBpbnR2ID0gJGludGVydmFsKGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0JHNjb3BlLnBsYXR0YXIuaW5pdChmdW5jdGlvbigpe1xyXG5cdFx0XHRcdFx0JGludGVydmFsLmNhbmNlbChpbnR2KTtcclxuXHRcdFx0XHRcdCRzY29wZS5wbGF0dGFyLm9wZW5TY2VuZShjb25maWcuc2NlbmVJZCk7XHJcblx0XHRcdFx0XHQkc2NvcGUubG9hZGVkID0gdHJ1ZTtcclxuXHRcdFx0XHRcdCRzY29wZS4kYXBwbHkoKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fSwgMjUwKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXSk7XHJcbiIsIlxuYW5ndWxhci5tb2R1bGUoJ1BsYXR0YXJFbWJlZCcpXG4uY29udHJvbGxlcignY29uZmlndXJhdG9yJywgWyckc2NvcGUnLCAnY29uZmlnJyxcblx0ZnVuY3Rpb24oJHNjb3BlLCBjb25maWcpIHtcblx0XHQkc2NvcGUuc2NlbmU7XG5cdFx0JHNjb3BlLnByb2R1Y3RzO1xuXG5cdFx0JHNjb3BlLnBsYXR0YXIuYXBpLmdldFNjZW5lKGNvbmZpZy5zY2VuZUlkLCBmdW5jdGlvbihyZXN1bHQpe1xuXHRcdFx0JHNjb3BlLnNjZW5lID0gcmVzdWx0O1xuXHRcdFx0JHNjb3BlLiRhcHBseSgpO1xuXHRcdH0pO1xuXG5cdFx0JHNjb3BlLnBsYXR0YXIuYXBpLmxpc3RQcm9kdWN0cyhjb25maWcuc2NlbmVJZCwgZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdCRzY29wZS5wcm9kdWN0cyA9IHJlc3VsdDtcblx0XHRcdCRzY29wZS4kYXBwbHkoKTtcblx0XHR9KTtcblxuXHRcdCRzY29wZS5zZWxlY3RWYXJpYXRpb24gPSBmdW5jdGlvbihwcm9kdWN0LCB2YXJpYXRpb24pe1xuXHRcdFx0cHJvZHVjdC5zZWxlY3RlZFZhcmlhdGlvbiA9IHZhcmlhdGlvbjtcblx0XHRcdCRzY29wZS5wbGF0dGFyLmxvYWRWYXJpYXRpb24ocHJvZHVjdC5pbnN0YW5jZWlkLCB2YXJpYXRpb24uaWQpO1xuXHRcdH07XG5cblx0XHQkc2NvcGUudG9nZ2xlVmlzaWJpbGl0eSA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQkKCcuY29uZmlndXJhdG9yLWNvbnRhaW5lcicpLnRvZ2dsZUNsYXNzKCdjb25maWd1cmF0b3ItY29udGFpbmVyLXZpc2libGUnKTtcblx0XHR9O1xuXHR9XG5dKTtcbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ1BsYXR0YXJFbWJlZCcpXG4uZGlyZWN0aXZlKCdpY29uJywgZnVuY3Rpb24oKSB7XG5cdHJldHVybiB7XG5cdFx0dGVtcGxhdGVVcmw6IGZ1bmN0aW9uKGVsZW0sIGF0dHIpIHtcblx0XHRcdGlmKCFhdHRyLnNyYyl7XG5cdFx0XHRcdGVsZW0uYXR0cignc3JjJywgYXR0clsnbmctc3JjJ10pO1xuXHRcdFx0XHRyZXR1cm4gJ2ljb25zL2ljb24tYmxhbmsuc3ZnJztcblx0XHRcdH1cblx0XHRcdHJldHVybiBhdHRyLnNyYztcblx0XHR9XG5cdH1cbn0pOyIsIlxuYW5ndWxhci5tb2R1bGUoJ1BsYXR0YXJFbWJlZCcpXG4uZGlyZWN0aXZlKCdpbWcnLCBmdW5jdGlvbigpIHtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogJ0UnLFxuXHRcdHNjb3BlOiB0cnVlLFxuXHRcdGNvbnRyb2xsZXI6IFsnJHNjb3BlJywgJyRlbGVtZW50Jyxcblx0XHRcdGZ1bmN0aW9uKCRzY29wZSwgJGVsZW1lbnQpe1xuXHRcdFx0XHQkZWxlbWVudC5hZGRDbGFzcygnc21vb3RobG9hZCcpO1xuXHRcdFx0XHQkZWxlbWVudC5hZGRDbGFzcygnc21vb3RobG9hZC1vdXQnKTtcblx0XHRcdFx0JGVsZW1lbnQub24oJ2xvYWQnLCBmdW5jdGlvbigpe1xuXHRcdFx0XHRcdCRlbGVtZW50LnJlbW92ZUNsYXNzKCdzbW9vdGhsb2FkLW91dCcpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRdXG5cdH1cbn0pIiwiXG5mdW5jdGlvbiBQbGF0dGFySW50ZWdyYXRpb24ocGFyYW1zKXtcblx0dmFyIHBhcmFtcyA9IHBhcmFtcyB8fCB7fTtcblx0aWYocGFyYW1zLmFwaVVybCA9PT0gdW5kZWZpbmVkKXtcblx0XHRwYXJhbXMuYXBpVXJsID0gJ2h0dHBzOi8vYXBwLnBsYXR0YXIuY29tJ1xuXHR9XG5cbiAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGF0dGFyLWZyYW1lJyk7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5yZWFkeUZ1bmMgPSBmdW5jdGlvbigpe2NvbnNvbGUubG9nKCdub3QgcmVhZHknKX07XG5cbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24oY2Ipe1xuICBcdHRoaXMucmVhZHlGdW5jID0gY2I7XG4gIFx0c2VuZE1lc3NhZ2UoJ2luaXRwcmV2aWV3Jywge1xuXHQgICAgb3JpZ2luOiBvcmlnaW4sXG5cdCAgICBvcHRpb25zOiB7XG5cdCAgICBcdGhlbHBzbGlkZXM6IGZhbHNlLFxuXHQgICAgfVxuXHQgIH0pO1xuICB9O1xuXG5cdGZ1bmN0aW9uIHNlbmRNZXNzYWdlKGFjdGlvbiwgZGF0YSl7XG5cdFx0Ly8gbWFrZSB0aGlzIHRpbWVvdXQgYWZ0ZXIgNSBhdHRlbXB0c1xuXHRcdGlmKCFpZnJhbWUpIHsgLy8gdXNlZCB0byByZXBlYXQgdGhlIGNhbGwgaWYgdGhlIGlmcmFtZSBpc24ndCByZWFkeSB5ZXRcblx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcblx0XHRcdFx0c2VuZE1lc3NhZ2UoYWN0aW9uLCBkYXRhKTtcblx0XHRcdH0sIDUwMCk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0YWN0aW9uID0gYWN0aW9uLnRvTG93ZXJDYXNlKCk7XG5cdFx0aWYoaWZyYW1lICE9PSB3aW5kb3cpe1xuICAgIFx0Y29uc29sZS5sb2coJyVjJyArIGFjdGlvbiwgXCJiYWNrZ3JvdW5kOiAjNjFmZjYxOyBjb2xvcjogIzAwMDsgcGFkZGluZzo0cHggOHB4O1wiLCBkYXRhKTtcbiAgICBcdHRhcmdldE9yaWdpbiA9IHBhcmFtcy5hcGlVcmw7XG4gICAgICBpZnJhbWUuY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSh7ZXZlbnROYW1lOiBhY3Rpb24sIGRhdGE6IGRhdGEgfHwge319LCBwYXJhbXMuYXBpVXJsKTtcblx0XHR9XG5cdH1cblxuXHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGZ1bmN0aW9uKGUpe1xuICAgIGNvbnNvbGUubG9nKCclYycgKyBlLmRhdGEuZXZlbnROYW1lLCBcImJhY2tncm91bmQ6ICM2MTcwZmY7IGNvbG9yOiAjMDAwOyBwYWRkaW5nOjRweCA4cHg7XCIsIGUuZGF0YS5kYXRhKTtcbiAgICB2YXIgZGF0YSA9IGUuZGF0YS5kYXRhO1xuXG4gICAgc3dpdGNoKGUuZGF0YS5ldmVudE5hbWUpe1xuICAgICAgY2FzZSAncHJldmlld3JlYWR5JzpcbiAgICAgIFx0c2VsZi5yZWFkeUZ1bmMoKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ29wZW51cmwnOlxuICAgICAgICBpZihlLmRhdGEuZGF0YS51cmwpe1xuICAgICAgICAgIHdpbmRvdy5vcGVuKGRhdGEudXJsLCAnX2JsYW5rJyk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ3NlbGVjdGFubm90YXRpb24nOlxuICAgICAgXHQvLyBBbm5vdGF0aW9uIGhhcyBjb250ZW50IHRvIGRpc3BsYXlcbiAgICAgICAgaWYoZGF0YS50aXRsZSl7XG4gICAgICAgICAgLy8gY3JlYXRlIGFubm90YXRpb24gcG9wdXAgd2l0aGluIHRoZSB0aGVtZVxuICAgICAgICB9XG4gICAgICAgIC8vIEFubm90YXRpb24gaXMgbGlua2luZyB0byBhIHdlYnNpdGVcbiAgICAgICAgZWxzZSBpZihkYXRhLnVybCl7XG4gICAgICAgIFx0Ly8gT3BlbiB0aGUgd2Vic2l0ZSBpbiBhIG5ldyB0YWJcbiAgICAgICAgICB3aW5kb3cub3BlbihkYXRhLnVybCwgJ19ibGFuaycpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFubm90YXRpb24gaXMgbGlua2luZyB0byBhIGRpZmZlcmVudCBzY2VuZVxuICAgICAgICBlbHNlIGlmKGRhdGEuc2NlbmVfaWQpe1xuICAgICAgICBcdC8vIFNldCBjb25maWcuc2NlbmVJZCB0byBuZXcgc2NlbmVJZFxuICAgICAgICBcdGNvbmZpZy5zY2VuZUlkID0gZGF0YS5zY2VuZV9pZDtcbiAgICAgICAgICAvLyBPcGVuIHRoZSBuZXcgc2NlbmVcbiAgICAgICAgICBzZWxmLm9wZW5TY2VuZShkYXRhLnNjY2VuZUlkKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH0pO1xuXG5cdHRoaXMub3BlblNjZW5lID0gZnVuY3Rpb24oc2NlbmVJZCkge1xuXHRcdHNlbmRNZXNzYWdlKCdsb2Fkc2NlbmUnLCB7XG5cdFx0XHRzY2VuZUlkOiBzY2VuZUlkXG5cdFx0fSk7XG5cdH07XG5cblx0dGhpcy5sb2FkVmFyaWF0aW9uID0gZnVuY3Rpb24ocHJvZHVjdElkLCB2YXJpYXRpb25JZCkge1xuXHRcdHNlbmRNZXNzYWdlKCdsb2FkcHJvZHVjdCcsIHtcblx0XHRcdHByb2R1Y3RJZDogcHJvZHVjdElkLFxuXHRcdFx0dmFyaWF0aW9uSWQ6IHZhcmlhdGlvbklkXG5cdFx0fSk7XG5cdH07XG5cblx0dGhpcy50b2dnbGVDYW1lcmEgPSBmdW5jdGlvbihhY3RpdmUpIHtcblx0XHRzZW5kTWVzc2FnZSgndG9nZ2xlQ2FtZXJhJywge2FjdGl2ZTogYWN0aXZlfSk7XG5cdH07XG5cblx0dGhpcy5hY3RpdmF0ZUhlbHAgPSBmdW5jdGlvbigpIHtcblx0XHRzZW5kTWVzc2FnZSgnYWN0aXZhdGVIZWxwJywge30pO1xuXHR9O1xuXG5cdHRoaXMucmVzZXRUcmFuc2Zvcm1zID0gZnVuY3Rpb24oKSB7XG5cdFx0c2VuZE1lc3NhZ2UoJ3Jlc2V0VHJhbnNmb3JtJywge30gKTtcblx0fTtcblxuXHR2YXIgaXNGdWxsc2NyZWVuID0gZmFsc2U7XG5cdHZhciBzdG9yZWRDc3MgPSB7fTtcblx0ZnVuY3Rpb24gZ29GdWxsc2NyZWVuKGVsZW0pe1xuXHRcdGlmKGVsZW0pe1xuXHRcdFx0dmFyIGRvY0VsID0gd2luZG93LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcblx0XHRcdHZhciByZXF1ZXN0RnVsbFNjcmVlbiA9IGRvY0VsLnJlcXVlc3RGdWxsc2NyZWVuIHx8IGRvY0VsLm1velJlcXVlc3RGdWxsU2NyZWVuIHx8IGRvY0VsLndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuIHx8IGRvY0VsLm1zUmVxdWVzdEZ1bGxzY3JlZW47XG5cblx0XHRcdGlmKHJlcXVlc3RGdWxsU2NyZWVuKXtcblx0XHRcdFx0cmVxdWVzdEZ1bGxTY3JlZW4uY2FsbChlbGVtKTtcblx0XHRcdH1cblx0XHRcdGVsc2V7XG5cdFx0XHRcdC8vIGlPUyBkZXZpY2UgZmFsbGJhY2tcblx0XHRcdFx0c3RvcmVkQ3NzLnBvc2l0aW9uID0gJChlbGVtKS5jc3MoJ3Bvc2l0aW9uJyk7XG5cdFx0XHRcdHN0b3JlZENzcy50b3AgPSAkKGVsZW0pLmNzcygndG9wJyk7XG5cdFx0XHRcdHN0b3JlZENzcy5sZWZ0ID0gJChlbGVtKS5jc3MoJ2xlZnQnKTtcblx0XHRcdFx0c3RvcmVkQ3NzLmJvdHRvbSA9ICQoZWxlbSkuY3NzKCdib3R0b20nKTtcblx0XHRcdFx0c3RvcmVkQ3NzLnJpZ2h0ID0gJChlbGVtKS5jc3MoJ3JpZ2h0Jyk7XG5cdFx0XHRcdHN0b3JlZENzcy5oZWlnaHQgPSAkKGVsZW0pLmNzcygnaGVpZ2h0Jyk7XG5cblx0XHRcdFx0JChlbGVtKS5jc3Moe1xuXHRcdFx0XHRcdHBvc2l0aW9uOiAnZml4ZWQnLFxuXHRcdFx0XHRcdHRvcDogMCxcblx0XHRcdFx0XHRsZWZ0OiAwLFxuXHRcdFx0XHRcdGJvdHRvbTogMCxcblx0XHRcdFx0XHRyaWdodDogMCxcblx0XHRcdFx0XHRoZWlnaHQ6ICcxMDAlJ1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cdFx0ZWxzZXtcblx0XHRcdHNlbmRNZXNzYWdlKCdnb0Z1bGxzY3JlZW4nLCB7fSApO1xuXHRcdH1cblx0XHRpc0Z1bGxzY3JlZW4gPSB0cnVlO1xuXHR9XG5cblx0ZnVuY3Rpb24gZXhpdEZ1bGxzY3JlZW4oZWxlbSl7XG5cdFx0aWYoZWxlbSl7XG5cdFx0XHQvLyBDcm9zcy1icm93c2VyIGNvbXBhdGlibGUgY29kZVxuXHRcdFx0aWYgKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSB7XG5cdFx0XHRcdGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7XG5cdFx0XHR9IGVsc2UgaWYgKGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKSB7XG5cdFx0XHRcdGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKCk7XG5cdFx0XHR9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4pIHtcblx0XHRcdFx0ZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbigpO1xuXHRcdFx0fSBlbHNlIGlmIChkb2N1bWVudC5tc0V4aXRGdWxsc2NyZWVuKSB7XG5cdFx0XHRcdGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4oKTtcblx0XHRcdH1cblx0XHRcdGVsc2V7XG5cdFx0XHRcdC8vIGlPUyBkZXZpY2UgZmFsbGJhY2tcblx0XHRcdFx0JChlbGVtKS5jc3Moc3RvcmVkQ3NzKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aXNGdWxsc2NyZWVuID0gZmFsc2U7XG5cdH1cblxuXHR0aGlzLnRvZ2dsZUZ1bGxzY3JlZW4gPSBmdW5jdGlvbihlbGVtKXtcblx0XHR2YXIgZnVsbHNjcmVlbkVsZW1lbnQgPSBkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC5tb3pGdWxsU2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC5tc0Z1bGxzY3JlZW5FbGVtZW50O1xuXHRcdGlmKGlzRnVsbHNjcmVlbiB8fCBmdWxsc2NyZWVuRWxlbWVudCl7XG5cdFx0XHRleGl0RnVsbHNjcmVlbihlbGVtKTtcblx0XHR9XG5cdFx0ZWxzZXtcblx0XHRcdGdvRnVsbHNjcmVlbihlbGVtKTtcblx0XHR9XG5cdH07XG5cblx0dGhpcy5hcGkgPSB7XG5cdFx0Z2V0U2NlbmU6IGZ1bmN0aW9uKHNjZW5lSWQsIHN1Y2Nlc3NGdW5jLCBlcnJvckZ1bmMpIHtcblx0XHRcdCQuZ2V0KHBhcmFtcy5hcGlVcmwgKyAnL2FwaS92Mi9zY2VuZS8nK3NjZW5lSWQsIGZ1bmN0aW9uKHJlc3VsdCl7XG5cdFx0XHRcdHN1Y2Nlc3NGdW5jKHJlc3VsdC5kYXRhKTtcblx0XHRcdH0pXG5cdFx0XHQuZmFpbChmdW5jdGlvbihlcnJvcil7XG5cdFx0XHRcdGlmKGVycm9yRnVuYyl7XG5cdFx0XHRcdFx0ZXJyb3JGdW5jKGVycm9yKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdGxpc3RQcm9kdWN0czogZnVuY3Rpb24oc2NlbmVJZCwgc3VjY2Vzc0Z1bmMsIGVycm9yRnVuYykge1xuXHRcdFx0JC5nZXQocGFyYW1zLmFwaVVybCArICcvYXBpL3YyL3NjZW5lLycrc2NlbmVJZCsnP2luY2x1ZGU9cHJvZHVjdCxwcm9kdWN0LnByb2R1Y3R2YXJpYXRpb24scHJvZHVjdC5wcm9kdWN0dmFyaWF0aW9uLmZpbGUsc2NlbmVwcm9kdWN0LHNjZW5lcHJvZHVjdC5wcm9kdWN0LHNjZW5lcHJvZHVjdC5wcm9kdWN0LnByb2R1Y3R2YXJpYXRpb24sc2NlbmVwcm9kdWN0LnByb2R1Y3QucHJvZHVjdHZhcmlhdGlvbi5maWxlJywgZnVuY3Rpb24ocmVzdWx0KXtcblx0XHRcdFx0aWYocmVzdWx0LmluY2x1ZGVkICYmIHJlc3VsdC5pbmNsdWRlZC5sZW5ndGgpe1xuXHRcdFx0XHRcdHZhciBwcm9kdWN0cyA9IHJlc3VsdC5pbmNsdWRlZC5maWx0ZXIoZnVuY3Rpb24oaW5jbHVkZSl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gKGluY2x1ZGUudHlwZSA9PSAncHJvZHVjdCcgJiYgaW5jbHVkZS5hdHRyaWJ1dGVzLnNjZW5lX2lkID09IHNjZW5lSWQpO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm1hcChmdW5jdGlvbihwcm9kdWN0KXtcblx0XHRcdFx0XHRcdHByb2R1Y3QuaW5zdGFuY2VpZCA9IHByb2R1Y3QuaWQ7XG5cdFx0XHRcdFx0XHRyZXR1cm4gcHJvZHVjdDtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdC8vIFRoaXMgcGFydCBpcyBmb3IgcHJvZHVjdCBpbnN0YW5jZXMgaW4gYSBzY2VuZS4gTWFwIHRoZW0gdG8gcHJvZHVjdCB0eXBlcyBmb3Igc2ltcGxpZmljYXRpb25cblx0XHRcdFx0XHR2YXIgc2NlbmVwcm9kdWN0cyA9IHJlc3VsdC5pbmNsdWRlZC5maWx0ZXIoZnVuY3Rpb24oaW5jbHVkZSl7XG5cdFx0XHRcdFx0XHRyZXR1cm4gaW5jbHVkZS50eXBlID09ICdzY2VuZXByb2R1Y3QnO1xuXHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0Lm1hcChmdW5jdGlvbihzY2VuZXByb2R1Y3Qpe1xuXHRcdFx0XHRcdFx0dmFyIHByb2R1Y3QgPSByZXN1bHQuaW5jbHVkZWQuZmluZChmdW5jdGlvbihpbmNsdWRlKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHNjZW5lcHJvZHVjdC5hdHRyaWJ1dGVzLnByb2R1Y3RfaWQgPT0gaW5jbHVkZS5pZDtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0Ly9jbG9uZSBlYWNoIHByb2R1Y3Rcblx0XHRcdFx0XHRcdHByb2R1Y3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHByb2R1Y3QpKTtcblx0XHRcdFx0XHRcdC8vb3ZlcndyaXRlIHZhcmlhYmxlc1xuXHRcdFx0XHRcdFx0cHJvZHVjdC5pbnN0YW5jZWlkID0gc2NlbmVwcm9kdWN0LmlkO1xuXHRcdFx0XHRcdFx0cHJvZHVjdC5hdHRyaWJ1dGVzLnRpdGxlID0gc2NlbmVwcm9kdWN0LmF0dHJpYnV0ZXMudGl0bGU7XG5cdFx0XHRcdFx0XHRwcm9kdWN0LmF0dHJpYnV0ZXMuc2NlbmVfaWQgPSBzY2VuZXByb2R1Y3QuYXR0cmlidXRlcy5zY2VuZV9pZDtcblx0XHRcdFx0XHRcdHJldHVybiBwcm9kdWN0O1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0Ly9hZGQgdG8gcHJvZHVjdHMgYXJyYXlcblx0XHRcdFx0XHRpZihzY2VuZXByb2R1Y3RzLmxlbmd0aCl7XG5cdFx0XHRcdFx0XHRwcm9kdWN0cyA9IHByb2R1Y3RzLmNvbmNhdChzY2VuZXByb2R1Y3RzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRwcm9kdWN0cy5mb3JFYWNoKGZ1bmN0aW9uKHByb2R1Y3Qpe1xuXHRcdFx0XHRcdFx0cHJvZHVjdC52YXJpYXRpb25zID0gcmVzdWx0LmluY2x1ZGVkLmZpbHRlcihmdW5jdGlvbihpbmNsdWRlKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGluY2x1ZGUudHlwZSA9PSAncHJvZHVjdHZhcmlhdGlvbicgJiYgKGluY2x1ZGUuYXR0cmlidXRlcy5wcm9kdWN0X2lkID09IHByb2R1Y3QuaWQpO1xuXHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdHByb2R1Y3QudmFyaWF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHZhcmlhdGlvbil7XG5cdFx0XHRcdFx0XHRcdHZhciB0aHVtYjtcblx0XHRcdFx0XHRcdFx0aWYodmFyaWF0aW9uLmF0dHJpYnV0ZXMuc3dhdGNoX2lkKXtcblx0XHRcdFx0XHRcdFx0XHR0aHVtYiA9IHJlc3VsdC5pbmNsdWRlZC5maW5kKGZ1bmN0aW9uKGluY2x1ZGUpe1xuXHRcdFx0XHRcdFx0XHRcdFx0cmV0dXJuIGluY2x1ZGUuaWQgPT0gdmFyaWF0aW9uLmF0dHJpYnV0ZXMuc3dhdGNoX2lkO1xuXHRcdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdGVsc2V7XG5cdFx0XHRcdFx0XHRcdFx0dGh1bWIgPSByZXN1bHQuaW5jbHVkZWQuZmluZChmdW5jdGlvbihpbmNsdWRlKXtcblx0XHRcdFx0XHRcdFx0XHRcdHJldHVybiBpbmNsdWRlLmlkID09IHZhcmlhdGlvbi5hdHRyaWJ1dGVzLmZpbGVfaWQ7XG5cdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdFx0aWYodGh1bWIpe1xuXHRcdFx0XHRcdFx0XHRcdHZhcmlhdGlvbi50aHVtYm5haWwgPSBlbmNvZGVVUkkoJ2h0dHBzOi8vY2RuLWRldi5wbGF0dGFyLnNwYWNlLycgKyB0aHVtYi5hdHRyaWJ1dGVzLnBhdGggKyB0aHVtYi5hdHRyaWJ1dGVzLnRodW1ibmFpbCk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0XHRwcm9kdWN0LnNlbGVjdGVkVmFyaWF0aW9uID0gcHJvZHVjdC52YXJpYXRpb25zLmZpbmQoZnVuY3Rpb24odmFyaWF0aW9uKXtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhcmlhdGlvbi5pZCA9PSBwcm9kdWN0LmF0dHJpYnV0ZXMucHJvZHVjdF92YXJpYXRpb25faWQ7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHN1Y2Nlc3NGdW5jKHByb2R1Y3RzKTtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdC5mYWlsKGZ1bmN0aW9uKGVycm9yKXtcblx0XHRcdFx0aWYoZXJyb3JGdW5jKXtcblx0XHRcdFx0XHRlcnJvckZ1bmMoZXJyb3IpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH07XG59XG4iLCJcbmFuZ3VsYXIubW9kdWxlKCdQbGF0dGFyRW1iZWQnKVxuLmNvbnRyb2xsZXIoJ3ZpZXdlcicsIFsnJHNjb3BlJywgJ2NvbmZpZycsICckc2NlJyxcblx0ZnVuY3Rpb24oJHNjb3BlLCBjb25maWcsICRzY2UpIHtcblx0XHQkc2NvcGUuZW1iZWRVcmwgPSAkc2NlLnRydXN0QXNSZXNvdXJjZVVybChjb25maWcuYXBpVXJsICsgJy93ZWJnbGVkaXRvci9wcmV2aWV3L2luZGV4Lmh0bWwnKTtcblx0XHQkc2NvcGUuaXNGdWxsc2NyZWVuID0gZmFsc2U7XG5cblx0XHR2YXIgY2FtZXJhRW5hYmxlZCA9IGZhbHNlO1xuXHRcdCRzY29wZS50b2dnbGVDYW1lcmEgPSBmdW5jdGlvbigpe1xuXHRcdFx0Y2FtZXJhRW5hYmxlZCA9ICFjYW1lcmFFbmFibGVkO1xuXHRcdFx0JHNjb3BlLnBsYXR0YXIudG9nZ2xlQ2FtZXJhKGNhbWVyYUVuYWJsZWQpO1xuXHRcdH07XG5cblx0XHQkc2NvcGUuZ29GdWxsc2NyZWVuID0gZnVuY3Rpb24oKXtcblx0XHRcdC8vIENhbGxpbmcgcGFyZW50IHJlcXVlc3RGdWxsc2NyZWVuIGZ1bmN0aW9uXG5cdFx0XHQkc2NvcGUucmVxdWVzdEZ1bGxzY3JlZW4oKTtcblx0XHRcdCRzY29wZS5pc0Z1bGxzY3JlZW4gPSAhJHNjb3BlLmlzRnVsbHNjcmVlbjtcblx0XHR9O1xuXG5cdFx0JHNjb3BlLmFjdGl2YXRlSGVscCA9IGZ1bmN0aW9uKGV2ZW50KXtcblx0XHRcdCRzY29wZS5wbGF0dGFyLmFjdGl2YXRlSGVscCgpO1xuXHRcdH07XG5cblx0XHQkc2NvcGUucmVzZXRUcmFuc2Zvcm1zID0gZnVuY3Rpb24oKXtcblx0XHRcdCRzY29wZS5wbGF0dGFyLnJlc2V0VHJhbnNmb3JtcygpO1xuXHRcdH07XG5cblx0XHRmdW5jdGlvbiBpc0Z1bGxzY3JlZW4oKXtcblx0XHRcdHJldHVybiBEb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC5tb3pGdWxsU2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC5tc0Z1bGxzY3JlZW5FbGVtZW50O1xuXHRcdH1cblx0XHRkb2N1bWVudC5vbmZ1bGxzY3JlZW5jaGFuZ2UgPSBkb2N1bWVudC5vbndlYmtpdGZ1bGxzY3JlZW5jaGFuZ2UgPSBkb2N1bWVudC5vbm1vemZ1bGxzY3JlZW5jaGFuZ2UgPSBkb2N1bWVudC5NU0Z1bGxzY3JlZW5DaGFuZ2UgPSBmdW5jdGlvbiAoIGV2ZW50ICkge1xuXHRcdFx0JHNjb3BlLmlzRnVsbHNjcmVlbiA9IGlzRnVsbHNjcmVlbigpO1xuXHRcdFx0JHNjb3BlLiRhcHBseSgpO1xuXHRcdH07XG5cdH1cbl0pO1xuIl19
